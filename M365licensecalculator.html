<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>M365 License Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-[#FDFBF7]">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect, useRef } = React;

    // --- 內建圖示庫 (防止 React 渲染衝突) ---
    const ICONS = {
      Calculator: <path d="M16 2H8a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z M12 6h.01 M16 6h.01 M12 10h.01 M16 10h.01 M12 14h.01 M16 14h.01 M8 18h8" />,
      Trash2: <><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></>,
      Plus: <path d="M5 12h14M12 5v14" />,
      Download: <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />,
      Check: <polyline points="20 6 9 17 4 12" />,
      AlertCircle: <><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></>,
      X: <path d="M18 6 6 18M6 6l12 12" />,
      ChevronDown: <path d="m6 9 6 6 6-6" />,
      Search: <><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></>,
      FileSpreadsheet: <><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><path d="M8 13h2" /><path d="M8 17h2" /><path d="M14 13h2" /><path d="M14 17h2" /></>,
      UploadCloud: <><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" /><path d="M12 12v9" /><path d="m16 16-4-4-4 4" /></>
    };

    const Icon = ({ name, className }) => {
      return (
        <svg 
          xmlns="http://www.w3.org/2000/svg" 
          width="24" 
          height="24" 
          viewBox="0 0 24 24" 
          fill="none" 
          stroke="currentColor" 
          strokeWidth="2" 
          strokeLinecap="round" 
          strokeLinejoin="round" 
          className={className}
        >
          {ICONS[name] || null}
        </svg>
      );
    };

    const CalculatorIcon = (p) => <Icon name="Calculator" {...p} />;
    const Trash2Icon = (p) => <Icon name="Trash2" {...p} />;
    const PlusIcon = (p) => <Icon name="Plus" {...p} />;
    const DownloadIcon = (p) => <Icon name="Download" {...p} />;
    const CheckIcon = (p) => <Icon name="Check" {...p} />;
    const AlertCircleIcon = (p) => <Icon name="AlertCircle" {...p} />;
    const XIcon = (p) => <Icon name="X" {...p} />;
    const ChevronDownIcon = (p) => <Icon name="ChevronDown" {...p} />;
    const SearchIcon = (p) => <Icon name="Search" {...p} />;
    const FileSpreadsheetIcon = (p) => <Icon name="FileSpreadsheet" {...p} />;
    const UploadCloudIcon = (p) => <Icon name="UploadCloud" {...p} />;

    const DEFAULT_DATA = [
      { category: "範例分類", plan: "範例方案", name: "請上傳 Excel (需有 'M365訂閱' 分頁)", price: 0 }
    ];

    const calculateDays = (start, end) => {
      const startDate = new Date(start);
      const endDate = new Date(end);
      if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) return 0;
      const diffTime = endDate.getTime() - startDate.getTime();
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
      return diffDays >= 0 ? diffDays + 1 : 0;
    };

    const calculatePrice = (originalPrice, days) => {
      if (!originalPrice || !days) return 0;
      const price = parseFloat(originalPrice);
      if (isNaN(price)) return 0;
      return Math.ceil((price / 365) * days);
    };

    const App = () => {
      const [database, setDatabase] = useState(DEFAULT_DATA); 
      const [items, setItems] = useState([]); 
      
      const [selectedCategory, setSelectedCategory] = useState('');
      const [selectedPlan, setSelectedPlan] = useState('');
      const [selectedProduct, setSelectedProduct] = useState('');
      const [searchKeyword, setSearchKeyword] = useState('');
      
      const [price, setPrice] = useState('');
      const [startDate, setStartDate] = useState('');
      const [endDate, setEndDate] = useState('');

      const [fileName, setFileName] = useState('');
      const fileInputRef = useRef(null);

      const categories = useMemo(() => {
        return [...new Set(database.map(d => d.category))].filter(Boolean);
      }, [database]);

      const availablePlans = useMemo(() => {
        if (!selectedCategory) return [];
        return [...new Set(database.filter(d => d.category === selectedCategory).map(d => d.plan))].filter(Boolean);
      }, [selectedCategory, database]);

      const availableProducts = useMemo(() => {
        if (!selectedCategory || !selectedPlan) return [];
        
        let filtered = database.filter(d => d.category === selectedCategory && d.plan === selectedPlan);
        
        if (searchKeyword.trim()) {
          const lowerKeyword = searchKeyword.toLowerCase();
          filtered = filtered.filter(d => d.name.toLowerCase().includes(lowerKeyword));
        }
        
        return filtered.map(d => d);
      }, [selectedCategory, selectedPlan, database, searchKeyword]);

      const handleCategoryChange = (e) => {
        setSelectedCategory(e.target.value);
        setSelectedPlan('');
        setSelectedProduct('');
        setSearchKeyword('');
        setPrice('');
      };

      const handlePlanChange = (e) => {
        setSelectedPlan(e.target.value);
        setSelectedProduct('');
        setSearchKeyword('');
        setPrice('');
      };

      const handleProductChange = (e) => {
        const productName = e.target.value;
        setSelectedProduct(productName);
        const foundItem = database.find(d => 
          d.category === selectedCategory && 
          d.plan === selectedPlan && 
          d.name === productName
        );
        if (foundItem) setPrice(foundItem.price);
      };

      const processFile = (file) => {
        if (!window.XLSX) {
          alert("系統正在初始化 Excel 核心，請稍等 3 秒後再試。");
          return;
        }

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = new Uint8Array(e.target.result);
            const workbook = window.XLSX.read(data, { type: 'array' });
            
            const targetSheetName = "M365訂閱";
            let sheetName = "";

            if (workbook.SheetNames.includes(targetSheetName)) {
              sheetName = targetSheetName;
            } else {
              sheetName = workbook.SheetNames[0];
            }

            const worksheet = workbook.Sheets[sheetName];
            const jsonData = window.XLSX.utils.sheet_to_json(worksheet, { header: 1 });
            const parsedData = [];
            
            for (let i = 1; i < jsonData.length; i++) {
              const row = jsonData[i];
              if (!row || row.length === 0) continue;

              const category = row[1] ? String(row[1]).trim() : ''; 
              const plan = row[2] ? String(row[2]).trim() : '';     
              const name = row[6] ? String(row[6]).trim() : '';     
              let rawPrice = row[7];                                

              let price = 0;
              if (typeof rawPrice === 'number') {
                price = rawPrice;
              } else if (typeof rawPrice === 'string') {
                price = parseFloat(rawPrice.replace(/[$,]/g, '').trim());
              }

              if (name && name !== "品名" && !isNaN(price)) {
                parsedData.push({ 
                  category: category || "未分類", 
                  plan: plan || "預設方案",       
                  name, 
                  price
                });
              }
            }

            if (parsedData.length > 0) {
              setDatabase(parsedData);
              setFileName(file.name);
              setSelectedCategory('');
              setSelectedPlan('');
              setSelectedProduct('');
              setSearchKeyword('');
              setPrice('');
              alert(`成功讀取工作表：「${sheetName}」\n共匯入 ${parsedData.length} 筆產品資料。`);
            } else {
              alert(`在工作表 "${sheetName}" 中找不到有效資料。`);
            }
          } catch (error) {
            console.error(error);
            alert("檔案解析發生錯誤: " + error.message);
          }
        };
        reader.readAsArrayBuffer(file);
      };

      const handleFileChange = (e) => {
        const file = e.target.files[0];
        if (file) processFile(file);
      };

      const handleAddItem = (e) => {
        e.preventDefault();
        if (!selectedProduct || !price || !startDate || !endDate) return;

        const days = calculateDays(startDate, endDate);
        const suggestedPrice = calculatePrice(price, days);

        const newItem = {
          id: Date.now(),
          category: selectedCategory,
          plan: selectedPlan,
          name: selectedProduct,
          originalPrice: parseFloat(price),
          start: startDate,
          end: endDate,
          days: days,
          suggestedPrice: suggestedPrice
        };

        setItems([newItem, ...items]);
        
        // 重置部分表單，保留日期和分類方案，方便連續輸入
        // 如果您希望每次都清空品名，保留下面這行
        setSelectedProduct(''); 
        setSearchKeyword(''); 
        setPrice(''); // 重置價格
      };

      const handleDelete = (id) => setItems(items.filter(item => item.id !== id));

      const handleExport = () => {
        const bom = '\uFEFF';
        const header = "分類,BillingPlan,授權名稱,授權原價,開始日期,結束日期,切齊天數,建議報價\n";
        const csvContent = items.map(item => 
          `${item.category},${item.plan},${item.name},${item.originalPrice},${item.start},${item.end},${item.days},${item.suggestedPrice}`
        ).join('\n');
        const blob = new Blob([bom + header + csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.setAttribute('download', `M365報價單_${new Date().toISOString().slice(0,10)}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      };

      const SelectField = ({ label, value, onChange, options, disabled, placeholder }) => (
        <div className="space-y-1.5 relative">
          <label className="text-xs font-bold text-[#A8A29E] tracking-wider ml-1">{label}</label>
          <div className="relative">
            <select
              value={value}
              onChange={onChange}
              disabled={disabled}
              className={`w-full appearance-none bg-[#FDFBF7] border-0 ring-1 rounded-xl px-4 py-3 text-[#57534E] text-sm focus:ring-2 focus:ring-[#D6D3D1] focus:outline-none transition-all cursor-pointer disabled:bg-[#F5F5F4] disabled:text-[#D6D3D1] disabled:cursor-not-allowed ${
                value ? 'ring-[#D6D3D1]' : 'ring-[#E7E5E4]'
              }`}
            >
              <option value="" disabled>{placeholder}</option>
              {options.map((opt) => <option key={opt} value={opt}>{opt}</option>)}
            </select>
            <ChevronDownIcon className="absolute right-3 top-3.5 w-4 h-4 text-[#A8A29E] pointer-events-none" />
          </div>
        </div>
      );

      return (
        <div className="min-h-screen font-sans selection:bg-[#D6D3D1] selection:text-white pb-10">
          <div className="max-w-6xl mx-auto px-6 py-12 relative">
            <header className="mb-10 text-center">
              <div className="inline-flex items-center justify-center p-3 mb-4 bg-white rounded-2xl shadow-sm border border-[#E7E5E4]">
                <CalculatorIcon className="w-6 h-6 text-[#78716C]" />
              </div>
              <h1 className="text-3xl font-light tracking-widest text-[#292524] mb-2">M365 License Calculator</h1>
              <p className="text-[#A8A29E] text-sm tracking-wider font-light">
                 匯入報價冊 · 計算切齊單價
              </p>
            </header>

            <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
              {/* 左側輸入區 */}
              <div className="lg:col-span-4 space-y-6">
                
                {/* 1. 微型資料來源卡片 */}
                <div className="bg-white/80 backdrop-blur-xl rounded-3xl p-5 shadow-[0_4px_20px_rgb(0,0,0,0.02)] border border-white/50">
                   <input 
                     type="file" 
                     ref={fileInputRef} 
                     className="hidden" 
                     accept=".xlsx, .xls" 
                     onChange={handleFileChange}
                   />
                   
                   {!fileName ? (
                     <button 
                       onClick={() => fileInputRef.current?.click()}
                       className="w-full group relative flex items-center justify-center gap-3 py-3 border border-dashed border-[#D6D3D1] rounded-xl hover:bg-[#F5F5F4] hover:border-[#A8A29E] transition-all"
                     >
                       <div className="p-1.5 bg-[#F5F5F4] rounded-lg text-[#78716C] group-hover:bg-white group-hover:shadow-sm transition-all">
                         <UploadCloudIcon className="w-4 h-4" />
                       </div>
                       <span className="text-sm text-[#57534E] font-medium tracking-wide">匯入 Excel 價目表</span>
                     </button>
                   ) : (
                     <div className="flex items-center justify-between bg-[#F5F5F4] rounded-xl p-3 border border-[#E7E5E4]">
                       <div className="flex items-center gap-3 overflow-hidden">
                         <div className="p-1.5 bg-white rounded-lg text-[#57534E] shadow-sm shrink-0">
                           <FileSpreadsheetIcon className="w-4 h-4" />
                         </div>
                         <div className="flex flex-col min-w-0">
                           <span className="text-xs font-medium text-[#57534E] truncate max-w-[150px]">{fileName}</span>
                           <span className="text-[10px] text-[#A8A29E]">{database.length} 筆商品</span>
                         </div>
                       </div>
                       <button 
                         onClick={() => fileInputRef.current?.click()}
                         className="text-[10px] bg-white border border-[#E7E5E4] text-[#78716C] px-2 py-1.5 rounded-lg hover:bg-[#E7E5E4] transition-colors shrink-0"
                       >
                         更換
                       </button>
                     </div>
                   )}
                </div>

                {/* 2. 計算表單 */}
                <div className="bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-white/50 relative overflow-hidden">
                  <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-[#D6D3D1] via-[#E7E5E4] to-[#F5F5F4]"></div>
                  
                  <div className="flex justify-between items-center mb-6">
                    <h2 className="text-lg font-medium text-[#57534E] flex items-center gap-2">
                      <PlusIcon className="w-4 h-4" />
                      新增報價項目
                    </h2>
                  </div>
                  
                  <form onSubmit={handleAddItem} className="space-y-5">
                    <SelectField 
                      label="1. 產品分類" 
                      value={selectedCategory} 
                      onChange={handleCategoryChange} 
                      options={categories}
                      placeholder="請選擇分類..."
                    />
                    <SelectField 
                      label="2. 計費方案" 
                      value={selectedPlan} 
                      onChange={handlePlanChange} 
                      options={availablePlans}
                      disabled={!selectedCategory}
                      placeholder={selectedCategory ? "選擇計費週期..." : "請先選擇分類"}
                    />
                    
                    {/* 3. 授權品名 (含關鍵字搜尋) */}
                    <div className="space-y-1.5">
                       <label className="text-xs font-bold text-[#A8A29E] tracking-wider ml-1">3. 授權品名</label>
                       
                       <div className="grid grid-cols-12 gap-2">
                         <div className="col-span-12 md:col-span-5 relative">
                           <input
                             type="text"
                             value={searchKeyword}
                             onChange={(e) => setSearchKeyword(e.target.value)}
                             disabled={!selectedPlan}
                             placeholder="搜尋關鍵字..."
                             className="w-full bg-[#F5F5F4] border-0 ring-1 ring-[#E7E5E4] rounded-xl pl-9 pr-3 py-3 text-[#57534E] text-sm focus:ring-2 focus:ring-[#D6D3D1] focus:bg-white focus:outline-none transition-all placeholder-[#D6D3D1] disabled:opacity-50"
                           />
                           <SearchIcon className="absolute left-3 top-3.5 w-4 h-4 text-[#A8A29E]" />
                           {searchKeyword && (
                             <button 
                               type="button" 
                               onClick={() => setSearchKeyword('')}
                               className="absolute right-2 top-3 p-0.5 text-[#A8A29E] hover:text-[#57534E] rounded-full hover:bg-[#E7E5E4]"
                             >
                               <XIcon className="w-3 h-3" />
                             </button>
                           )}
                         </div>

                         <div className="col-span-12 md:col-span-7 relative">
                           <select
                             value={selectedProduct}
                             onChange={handleProductChange}
                             disabled={!selectedPlan}
                             className={`w-full appearance-none bg-[#FDFBF7] border-0 ring-1 rounded-xl px-4 py-3 text-[#57534E] text-sm focus:ring-2 focus:ring-[#D6D3D1] focus:outline-none transition-all cursor-pointer disabled:bg-[#F5F5F4] disabled:text-[#D6D3D1] disabled:cursor-not-allowed ${
                               selectedProduct ? 'ring-[#D6D3D1]' : 'ring-[#E7E5E4]'
                             }`}
                           >
                             <option value="" disabled>
                               {selectedPlan 
                                 ? (availableProducts.length === 0 ? "無符合項目" : `請選擇產品 (${availableProducts.length}項)`)
                                 : "請先選擇方案"}
                             </option>
                             {availableProducts.map((prod) => (
                                <option key={prod.name} value={prod.name}>{prod.name}</option>
                             ))}
                           </select>
                           <ChevronDownIcon className="absolute right-3 top-3.5 w-4 h-4 text-[#A8A29E] pointer-events-none" />
                         </div>
                       </div>
                    </div>

                    <div className="pt-2 border-t border-dashed border-[#E7E5E4] mt-2"></div>
                    <div className="space-y-1">
                      <label className="text-xs font-bold text-[#A8A29E] tracking-wider ml-1">授權原價 (自動帶入)</label>
                      <div className="relative">
                        <span className="absolute left-4 top-3 text-[#D6D3D1]">$</span>
                        <input
                          type="number"
                          value={price}
                          onChange={(e) => setPrice(e.target.value)}
                          placeholder="0"
                          className="w-full bg-[#F5F5F4] border-0 ring-1 ring-[#E7E5E4] rounded-xl pl-8 pr-4 py-3 text-[#57534E] focus:bg-white focus:ring-2 focus:ring-[#D6D3D1] focus:outline-none transition-all font-mono font-medium"
                        />
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div className="space-y-1">
                        <label className="text-xs font-bold text-[#A8A29E] tracking-wider ml-1">起始日</label>
                        <input type="date" value={startDate} onChange={(e) => setStartDate(e.target.value)} className="w-full bg-[#FDFBF7] border-0 ring-1 ring-[#E7E5E4] rounded-xl px-3 py-3 text-[#57534E] text-xs focus:ring-2 focus:ring-[#D6D3D1] focus:outline-none transition-all" />
                      </div>
                      <div className="space-y-1">
                        <label className="text-xs font-bold text-[#A8A29E] tracking-wider ml-1">結束日</label>
                        <input type="date" value={endDate} onChange={(e) => setEndDate(e.target.value)} className="w-full bg-[#FDFBF7] border-0 ring-1 ring-[#E7E5E4] rounded-xl px-3 py-3 text-[#57534E] text-xs focus:ring-2 focus:ring-[#D6D3D1] focus:outline-none transition-all" />
                      </div>
                    </div>
                    {price && startDate && endDate && (
                      <div className="bg-[#F5F5F4] rounded-xl p-4 flex justify-between items-center text-sm text-[#78716C] animate-in fade-in slide-in-from-top-1">
                        <span>{calculateDays(startDate, endDate)} 天</span>
                        <span className="font-medium text-[#57534E]">${calculatePrice(price, calculateDays(startDate, endDate)).toLocaleString()}</span>
                      </div>
                    )}
                    <button type="submit" disabled={!selectedProduct || !price || !startDate || !endDate} className="w-full bg-[#57534E] text-[#FDFBF7] rounded-xl py-3.5 font-medium shadow-lg hover:bg-[#44403C] active:scale-[0.98] transition-all duration-300 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                      <CheckIcon className="w-4 h-4" /> 加入清單
                    </button>
                  </form>
                </div>
              </div>

              {/* 右側結果列表 */}
              <div className="lg:col-span-8">
                 <div className="bg-white/80 backdrop-blur-xl rounded-3xl p-6 min-h-[600px] shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-white/50 flex flex-col relative">
                    <div className="flex justify-between items-end mb-6 pb-4 border-b border-[#F5F5F4]">
                      <div>
                        <h2 className="text-lg font-medium text-[#57534E] mb-1">報價清單</h2>
                        <p className="text-xs text-[#A8A29E]">共 {items.length} 筆資料</p>
                      </div>
                      {items.length > 0 && (
                        <div className="flex gap-3">
                          <button onClick={() => setItems([])} className="text-xs text-[#A8A29E] hover:text-red-400 transition-colors flex items-center gap-1 px-3 py-2"><Trash2Icon className="w-3 h-3" /> 清空</button>
                          <button onClick={handleExport} className="text-xs bg-[#E7E5E4] text-[#57534E] px-4 py-2 rounded-lg hover:bg-[#D6D3D1] transition-colors flex items-center gap-2 font-medium"><DownloadIcon className="w-3 h-3" /> 匯出 CSV</button>
                        </div>
                      )}
                    </div>
                    <div className="flex-1 overflow-auto pr-2 custom-scrollbar">
                      {items.length === 0 ? (
                        <div className="h-full flex flex-col items-center justify-center text-[#D6D3D1] space-y-4 opacity-50">
                          <SearchIcon className="w-16 h-16 stroke-1" />
                          <p className="font-light tracking-wider">請由左側上傳 Excel 並選擇產品</p>
                        </div>
                      ) : (
                        <div className="space-y-3">
                          <div className="hidden md:grid grid-cols-12 text-xs text-[#A8A29E] px-4 pb-2 font-medium tracking-wider">
                            <div className="col-span-4">產品資訊</div>
                            <div className="col-span-2 text-right">原價/週期</div>
                            <div className="col-span-3 text-center">起訖日期</div>
                            <div className="col-span-1 text-center">天數</div>
                            <div className="col-span-2 text-right">建議單價</div>
                          </div>
                          {items.map((item) => (
                            <div key={item.id} className="group relative bg-white border border-[#F5F5F4] rounded-xl p-4 md:py-3 md:px-4 hover:border-[#E7E5E4] hover:shadow-md transition-all duration-300 grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-0 items-center animate-in fade-in slide-in-from-bottom-2">
                              <div className="col-span-4">
                                <div className="flex flex-col">
                                  <span className="text-xs text-[#A8A29E] md:hidden">授權</span>
                                  <div className="flex items-center gap-2"><span className="font-medium text-[#57534E] text-sm truncate" title={item.name}>{item.name}</span></div>
                                  <div className="flex gap-2 mt-1">
                                    <span className="text-[10px] text-[#A8A29E] bg-[#F5F5F4] px-1.5 py-0.5 rounded border border-[#E7E5E4]">{item.category}</span>
                                    <span className="text-[10px] text-[#78716C] bg-[#E7E5E4]/50 px-1.5 py-0.5 rounded">{item.plan}</span>
                                  </div>
                                </div>
                              </div>
                              <div className="col-span-2 text-left md:text-right font-mono text-[#A8A29E] text-sm"><span className="text-xs md:hidden mr-2">原價:</span>${item.originalPrice.toLocaleString()}</div>
                              <div className="col-span-3 flex flex-col items-start md:items-center justify-center text-xs text-[#78716C]"><span>{item.start}</span><div className="w-0.5 h-2 bg-[#E7E5E4] my-0.5 hidden md:block"></div><span>{item.end}</span></div>
                              <div className="col-span-1 text-left md:text-center text-xs"><span className="md:hidden text-[#A8A29E] mr-2">天數:</span><span className="bg-[#F5F5F4] text-[#57534E] px-2 py-1 rounded-md font-mono">{item.days}</span></div>
                              <div className="col-span-2 text-left md:text-right"><span className="text-xs text-[#A8A29E] md:hidden mr-2">建議單價:</span><span className="font-mono text-lg font-medium text-[#57534E]">${item.suggestedPrice.toLocaleString()}</span></div>
                              <div className="absolute top-2 right-2 md:relative md:top-auto md:right-auto md:col-span-0 md:hidden group-hover:block"><button onClick={() => handleDelete(item.id)} className="text-[#D6D3D1] hover:text-red-400 p-1 md:p-0 transition-colors"><XIcon className="w-4 h-4" /></button></div>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                    {items.length > 0 && (
                       <div className="mt-6 pt-4 border-t border-[#F5F5F4] flex flex-col md:flex-row justify-between items-center text-[#78716C] gap-4 md:gap-0">
                         <div className="text-xs flex items-center bg-[#FDFBF7] px-3 py-2 rounded-lg border border-[#E7E5E4]">
                           <AlertCircleIcon className="w-3 h-3 inline mr-2 text-[#A8A29E]" />
                           <span>計算公式: <code>ceil(H欄售價 / 365 * (天數))</code></span>
                         </div>
                         <div className="text-right flex items-baseline gap-3"><span className="text-xs text-[#A8A29E]">預估總金額 (未稅)</span><span className="text-2xl font-light text-[#292524]">${items.reduce((acc, curr) => acc + curr.suggestedPrice, 0).toLocaleString()}</span></div>
                       </div>
                    )}
                 </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>